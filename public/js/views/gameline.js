// Generated by CoffeeScript 1.3.3

/*
  gameline.coffee
*/


(function() {

  define(['underscore', 'backbone'], function(_, Backbone) {
    var GameLineView;
    GameLineView = Backbone.View.extend({
      tagName: 'li',
      template: _.template($('#game-template').html()),
      initialize: function() {
        this.playerid = this.options.playerid;
        return this.model.on('change', this.updateLine, this);
      },
      events: {
        "click .delete": "deleteGame",
        "click .join": "joinGame",
        "click .start": "startGame",
        "click .quit": "quitGame",
        "click .play": "playGame"
      },
      /*
            Rendering
      */

      render: function() {
        this.$el.html(this.template());
        return this.updateLine();
      },
      updateLine: function() {
        this.updateNbPlayers();
        this.updateTitle();
        this.updateStatus();
        this.updateJoinBtn();
        this.updatePlayBtn();
        this.updateStartBtn();
        this.updateDeleteBtn();
        return this.updateQuitBtn();
      },
      updateDeleteBtn: function() {
        if (this.model.canDelete(this.playerid)) {
          return this.$('.delete').show();
        } else {
          return this.$('.delete').hide();
        }
      },
      updateStartBtn: function() {
        if (this.model.canStart(this.playerid)) {
          return this.$('.start').show();
        } else {
          return this.$('.start').hide();
        }
      },
      updateJoinBtn: function() {
        if (this.model.canJoin(this.playerid)) {
          return this.$('.join').show();
        } else {
          return this.$('.join').hide();
        }
      },
      updatePlayBtn: function() {
        if (this.model.canPlay(this.playerid)) {
          return this.$('.play').show();
        } else {
          return this.$('.play').hide();
        }
      },
      updateQuitBtn: function() {
        if (this.model.canQuit(this.playerid)) {
          return this.$('.quit').show();
        } else {
          return this.$('.quit').hide();
        }
      },
      updateNbPlayers: function() {
        return this.$('.players').html(this.model.getPlayersStr());
      },
      updateStatus: function() {
        return this.$el.addClass(this.model.getStatusStr());
      },
      updateTitle: function() {
        var names,
          _this = this;
        names = this.model.get('playerNames');
        this.$('.title').empty();
        return _.each(names, function(name, idx) {
          var span;
          span = $('<span>' + name + '</span>');
          if (idx === _this.model.get('turn').player) {
            span.addClass('current');
          }
          return _this.$('.title').append(span);
        });
      },
      /*
            Event handlers
      */

      deleteGame: function() {
        var _this = this;
        return this.model.destroy({
          success: function(model, response) {
            return _this.$el.remove();
          }
        });
      },
      joinGame: function() {
        return this.trigger('join', this.model.id);
      },
      startGame: function() {
        return this.trigger('start', this.model.id);
      },
      quitGame: function() {
        return this.trigger('quit', this.model.id);
      },
      playGame: function() {
        return this.trigger('play', this.model);
      }
    });
    return GameLineView;
  });

}).call(this);
