// Generated by CoffeeScript 1.3.3

/*
  gameline.coffee
*/


(function() {

  define(['underscore', 'backbone'], function(_, Backbone) {
    var GameLineView;
    GameLineView = Backbone.View.extend({
      tagName: 'li',
      template: _.template($('#game-template').html()),
      initialize: function() {
        this.playerid = this.options.playerid;
        return this.model.on('change', this.updateLine, this);
      },
      events: {
        "click .delete": "deleteGame",
        "click .join": "joinGame"
      },
      /*
            Rendering
      */

      render: function() {
        var params;
        params = {
          status: this.model.get('status'),
          date: this.model.getDateStr()
        };
        this.$el.html(this.template(params));
        return this.updateLine();
      },
      updateLine: function() {
        this.updateNbPlayers();
        this.updateStatus();
        this.updateJoinBtn();
        this.updatePlayBtn();
        this.updateStartBtn();
        return this.updateDeleteBtn();
      },
      updateDeleteBtn: function() {
        if (this.model.canDelete(this.playerid)) {
          return this.$('.delete').show();
        } else {
          return this.$('.delete').hide();
        }
      },
      updateStartBtn: function() {
        if (this.model.canStart(this.playerid)) {
          return this.$('.start').show();
        } else {
          return this.$('.start').hide();
        }
      },
      updateJoinBtn: function() {
        if (this.model.canJoin(this.playerid)) {
          return this.$('.join').show();
        } else {
          return this.$('.join').hide();
        }
      },
      updatePlayBtn: function() {
        if (this.model.canPlay(this.playerid)) {
          return this.$('.play').show();
        } else {
          return this.$('.play').hide();
        }
      },
      updateNbPlayers: function() {
        return this.$('.players').html(this.model.getPlayersStr());
      },
      updateStatus: function() {
        return this.$el.addClass(this.model.getStatusStr());
      },
      /*
            Event handlers
      */

      deleteGame: function() {
        var _this = this;
        return this.model.destroy({
          success: function(model, response) {
            return _this.$el.remove();
          }
        });
      },
      joinGame: function() {
        return this.trigger('join', this.model.id);
      }
    });
    return GameLineView;
  });

}).call(this);
