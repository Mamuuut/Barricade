// Generated by CoffeeScript 1.5.0
(function() {

  define(['backbone'], function(Backbone) {
    var ChatView;
    ChatView = Backbone.View.extend({
      el: $("#chat"),
      chatSocket: null,
      template: _.template($('#chat-template').html()),
      initialize: function() {
        var _this = this;
        this.socket = io.connect();
        return this.socket.on('new message', function(userMessage) {
          var newMessage;
          newMessage = $(_this.template(userMessage));
          _this.$('#conversation').prepend(newMessage);
          return setTimeout(function() {
            return newMessage.addClass('visible', 0);
          });
        });
      },
      events: {
        "click .header": "switchSize",
        "keypress #new_message": "keyPressed"
      },
      switchSize: function() {
        return this.$el.toggleClass('minimized');
      },
      keyPressed: function(e) {
        var message;
        if (e.which === 13) {
          message = this.$('#new_message').val();
          this.$('#new_message').val('');
          return this.socket.emit('send message', message);
        }
      }
    });
    return ChatView;
  });

}).call(this);
