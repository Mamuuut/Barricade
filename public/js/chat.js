// Generated by CoffeeScript 1.3.3

/*
  chat.coffee
*/


(function() {

  define(function() {
    var initialize;
    initialize = function(user) {
      var chatSocket;
      chatSocket = io.connect('/chat');
      chatSocket.on('connect', function() {
        return chatSocket.emit('new user', user);
      });
      chatSocket.on('new message', function(userMessage) {
        var newMessage;
        newMessage = $('<span>' + '<b>' + userMessage.username + ' : </b>' + userMessage.message + '<br/>' + '</span>');
        ($('#conversation')).prepend(newMessage);
        return setTimeout(function() {
          return newMessage.addClass('visible', 0);
        });
      });
      return ($('#new_message')).keypress(function(e) {
        var message;
        if (e.which === 13) {
          message = ($('#new_message')).val();
          ($('#new_message')).val('');
          return chatSocket.emit('send message', message);
        }
      });
    };
    return {
      initialize: initialize
    };
  });

}).call(this);
